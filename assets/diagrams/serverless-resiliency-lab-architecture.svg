<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="960" height="540" viewBox="0 0 960 540" role="img" aria-labelledby="title desc">
  <title id="title">Serverless Resiliency Lab Architecture</title>
  <desc id="desc">Diagram showing a private VPC containing Lambda, EventBridge, DynamoDB, and S3 resources connected through VPC endpoints and an API Gateway interface endpoint.</desc>
  <style>
    .frame { fill: none; stroke: #0b7285; stroke-width: 3; }
    .box { fill: #e6f4f1; stroke: #0b7285; stroke-width: 2; rx: 12; ry: 12; }
    .service { font: 15px "Segoe UI", sans-serif; fill: #1f2933; text-anchor: middle; }
    .caption { font: 13px "Segoe UI", sans-serif; fill: #334155; text-anchor: middle; }
    .connector { stroke: #2b4c7e; stroke-width: 2.5; marker-end: url(#arrow); fill: none; }
    .dashed { stroke-dasharray: 6 4; }
    .label { font: 12px "Segoe UI", sans-serif; fill: #2b4c7e; text-anchor: middle; }
  </style>
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M0 0 L10 5 L0 10 z" fill="#2b4c7e"/>
    </marker>
  </defs>

  <!-- VPC boundary -->
  <rect class="frame" x="60" y="60" width="620" height="420" rx="20" ry="20"/>
  <text class="caption" x="370" y="50">Private VPC (10.20.0.0/24)</text>

  <!-- Subnet -->
  <rect class="frame" x="100" y="100" width="540" height="340" rx="16" ry="16" stroke-dasharray="10 6"/>
  <text class="caption" x="370" y="95">Private Subnet (10.20.0.0/28)</text>

  <!-- Lambda -->
  <rect class="box" x="170" y="140" width="160" height="90"/>
  <text class="service" x="250" y="185">AWS Lambda</text>
  <text class="caption" x="250" y="205">writer function</text>

  <!-- EventBridge -->
  <rect class="box" x="170" y="280" width="160" height="90"/>
  <text class="service" x="250" y="325">Amazon EventBridge</text>
  <text class="caption" x="250" y="345">scheduled heartbeat</text>

  <!-- DynamoDB -->
  <rect class="box" x="450" y="140" width="160" height="90"/>
  <text class="service" x="530" y="185">Amazon DynamoDB</text>
  <text class="caption" x="530" y="205">telemetry table</text>

  <!-- S3 -->
  <rect class="box" x="450" y="280" width="160" height="90"/>
  <text class="service" x="530" y="325">Amazon S3</text>
  <text class="caption" x="530" y="345">payload archive</text>

  <!-- KMS -->
  <rect class="box" x="300" y="400" width="180" height="80"/>
  <text class="service" x="390" y="440">AWS KMS</text>
  <text class="caption" x="390" y="460">alias/serverless-resiliency-lab</text>

  <!-- API Gateway outside VPC -->
  <rect class="box" x="760" y="160" width="140" height="100"/>
  <text class="service" x="830" y="205">Amazon API</text>
  <text class="service" x="830" y="225">Gateway (private)</text>
  <text class="caption" x="830" y="245">POST /ingest</text>

  <!-- Interface endpoint -->
  <rect class="box" x="660" y="200" width="70" height="80"/>
  <text class="caption" x="695" y="240">VPC</text>
  <text class="caption" x="695" y="255">Endpoint</text>
  <text class="caption" x="695" y="270">execute-api</text>

  <!-- Gateway endpoints -->
  <rect class="box" x="640" y="320" width="90" height="70"/>
  <text class="caption" x="685" y="350">Gateway</text>
  <text class="caption" x="685" y="365">Endpoint</text>
  <text class="caption" x="685" y="380">S3 / DDB</text>

  <!-- Connections -->
  <path class="connector" d="M250 230 L250 280"/>
  <text class="label" x="250" y="265">Invoke</text>

  <path class="connector" d="M330 185 L450 185"/>
  <text class="label" x="390" y="175">PutItem</text>

  <path class="connector" d="M330 325 L450 325"/>
  <text class="label" x="390" y="315">PutObject</text>

  <path class="connector" d="M530 230 L530 280"/>
  <text class="label" x="530" y="255">Archive</text>

  <path class="connector" d="M250 230 L530 420"/>
  <text class="label" x="360" y="335">Encrypt / Decrypt</text>

  <path class="connector" d="M530 185 L640 340"/>
  <text class="label" x="600" y="240">Private access</text>

  <path class="connector" d="M530 325 L640 340"/>

  <path class="connector" d="M640 240 L760 210"/>
  <text class="label" x="700" y="210">Private invoke</text>

  <path class="connector dashed" d="M330 185 L710 350"/>
  <path class="connector dashed" d="M330 325 L710 350"/>

  <!-- Legend -->
  <rect class="box" x="60" y="460" width="220" height="70"/>
  <text class="caption" x="170" y="485">Legend</text>
  <text class="label" x="170" y="505">Solid line: Active data flow</text>
  <text class="label" x="170" y="525">Dashed line: Access via gateway endpoints</text>
</svg>
